---
import { getAlbumImages, getImagesMetadata } from '../../utils/albums';
import { getCollection } from 'astro:content';
import { Image } from 'astro:assets';
import Layout from '../../layouts/Layout.astro';

export async function getStaticPaths() {
    const albums = await getCollection("albums");
    const paths = Object.values(albums).map((album) => {
        return {
            params: {
                slug: album.slug,
            },
            props: {
                album,
            },
        };
    });
    return paths;
}

const { album } = Astro.props;
const albumImages = await getAlbumImages(album.slug);
---
<Layout title={album.data.title}>
    <h1>{album.data.title}</h1>
    <div class="image-gallery bg-dark">
    {
        albumImages.map((albumImage) => {
            let width = albumImage.width / 24;
            let height = albumImage.height / 24;
            return (
                <div>
                    <button class="btn btn-transparent" type="button" data-bs-toggle="modal" data-bs-target={'#' + albumImage.meta.domId}>
                        <Image
                            src={albumImage}
                            alt={`From ${album.data.title} album`}
                            class="image-gallery-preview"
                            loading="eager"
                            width={width}
                            height={height}
                        />
                    </button>

                    <div class="modal fade" id={albumImage.meta.domId} tabindex="-1" aria-labelledby={albumImage.meta.domId + 'Label'} aria-hidden="true">
                        <div class="modal-dialog modal-xl">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h1 class="modal-title" id={albumImage.meta.domId + 'Label'}>{albumImage.meta.data ? albumImage.meta.data.title : ""}</h1>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    <Image
                                        src={albumImage}
                                        alt={`From ${album.data.title} album`}
                                        class="image-gallery-view"
                                        loading="lazy"
                                    />
                                </div>
                                <div class="modal-footer">
                                    <span>{albumImage.meta.data ? albumImage.meta.data.description : ""}</span>
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            )
        })
    }
    </div>
</Layout>
<style>
    .image-gallery {
        display: flex;
        flex-wrap: wrap;
    }
    .image-gallery-preview {
        border-radius: 5px;
    }
    .image-gallery-view {
        object-fit: cover;
        width: 100%;
        height: 100%;
        vertical-align: middle;
        border-radius: 5px;
    }
</style>